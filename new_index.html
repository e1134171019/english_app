<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8">
  <title>個人英文練習網站</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- PWA 支援 -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#6366F1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="英文字卡">

  <link rel="stylesheet" href="style.css">
</head>

<body>

  <!-- 翻譯浮窗 -->
  <div id="translation-tooltip" class="translation-tooltip"></div>

  <!-- 首頁畫面 -->
  <div id="home-screen" class="screen active">
    <h1 class="app-title">個人英文練習網站</h1>

    <div class="menu-container">
      <div class="menu-grid">
        <!-- 單字練習：先進入「學制 / 年級」選單 -->
        <button class="menu-btn" data-target="level-select-screen" data-mode="practice">
          <span class="menu-icon">📖</span>
          <span class="menu-text">單字練習</span>
        </button>
        <!-- 聽力測驗：一樣進入同一個 level-select，但 mode 是 quiz -->
        <button class="menu-btn" data-target="level-select-screen" data-mode="quiz">
          <span class="menu-icon">🎧</span>
          <span class="menu-text">聽力測驗</span>
        </button>
        <!-- 高中進階訓練 -->
        <button class="menu-btn" data-target="advanced-screen">
          <span class="menu-icon">🎓</span>
          <span class="menu-text">高中進階訓練</span>
        </button>
        <!-- 新增單字 -->
        <button class="menu-btn" data-target="add-screen">
          <span class="menu-icon">➕</span>
          <span class="menu-text">新增單字</span>
        </button>
        <!-- 刪除單字 -->
        <button class="menu-btn" data-target="delete-screen">
          <span class="menu-icon">🗑️</span>
          <span class="menu-text">刪除單字</span>
        </button>
        <!-- 自訂義訓練 -->
        <button class="menu-btn" data-target="custom-training-screen">
          <span class="menu-icon">✨</span>
          <span class="menu-text">自訂義訓練</span>
        </button>
      </div>
    </div>
  </div>

  <!-- 單字練習畫面 -->
  <div id="practice-screen" class="screen hidden">
    <button class="back-btn" onclick="showScreen('home-screen')">← 返回</button>
    <h2 class="screen-title">單字練習</h2>

    <!-- 卡片 -->
    <div class="card-container">
      <div class="card" id="flashcard">
        <!-- 正面（中文） -->
        <div class="card-face card-front">
          <div class="chinese-word" id="card-chinese">載入中...</div>
          <button class="flip-hint-btn" onclick="flipCard()">查看英文</button>
        </div>

        <!-- 背面（英文） -->
        <div class="card-face card-back">
          <div class="header-row">
            <div class="header-left">
              <span class="english-word" id="card-english">Word</span>
              <button class="icon-btn" title="朗讀單字" onclick="speakText(currentCard.word, 1.0)">
                🔊
              </button>
            </div>
            <span class="pos" id="card-pos">n.</span>
          </div>

          <span class="phonetic" id="card-phonetic">/.../</span>

          <div class="section-title">解釋</div>
          <div class="explanation" id="card-meaning"></div>

          <div class="section-title">搭配詞</div>
          <ul class="collocation-list" id="back-collocations"></ul>

          <div class="section-title">例句</div>

          <div class="sentence-box" id="card-sentence-box"
            onclick="if(window.getSelection().toString().length === 0) speakText(currentCard.sentence1.en, 0.9)">
            <span class="sentence-en" id="card-example-en"></span>
            <span class="sentence-cn" id="card-example-zh"></span>
          </div>

          <button class="flip-back-btn-large" onclick="flipCard()" title="返回中文">
            ↻
          </button>
        </div>
      </div>
    </div>

    <!-- 底部控制列 -->
    <div class="bottom-controls">
      <div class="nav-bar">
        <button class="nav-btn" id="prevBtn" onclick="prevCard()">&lt;</button>
        <span id="page-indicator" class="page-indicator">1 / 1</span>
        <button class="nav-btn" id="nextBtn" onclick="nextCard()">&gt;</button>
      </div>

      <div class="settings-bar">
        <span class="label">語速</span>
        <input type="range" id="speed-range" min="0.5" max="1.5" step="0.1" value="1.0"
          oninput="updateSpeed(this.value)">
        <button class="auto-play-btn" id="auto-play-btn" onclick="autoPlayCurrent()">
          ▶ 自動朗讀
        </button>
      </div>
    </div>
  </div>

  <!-- 新增單字 Modal -->
  <div class="modal-overlay" id="add-modal">
    <div class="modal">
      <h2>✨ 新增單字（手動輸入）</h2>

      <div class="form-group">
        <label>英文單字</label>
        <input type="text" id="input-word" placeholder="例如：serendipity">
      </div>

      <div class="scroll-area">
        <div class="form-group">
          <label>正面中文（大字顯示）</label>
          <input type="text" id="input-front" placeholder="例如：意外的驚喜；機緣巧合">
        </div>

        <div class="form-row">
          <div class="form-group half">
            <label>詞性</label>
            <input type="text" id="input-pos" placeholder="n. / v. / adj. ...">
          </div>
          <div class="form-group half">
            <label>音標（可略）</label>
            <input type="text" id="input-phonetic" placeholder="/ˌser.ənˈdɪp.ə.t̬i/">
          </div>
        </div>

        <div class="form-group">
          <label>英文解釋 + 中文</label>
          <textarea id="input-meaning" rows="3"
            placeholder="A pleasant surprise that happens by chance.（意外的驚喜）"></textarea>
        </div>

        <div class="form-group">
          <label>搭配詞 / 相似家族（每行一個）</label>
          <textarea id="input-collocations" rows="3"
            placeholder="have the opportunity to ...（有機會...）&#10;opportune（適當的）&#10;opportunist（機會主義者）"></textarea>
        </div>

        <div class="form-group">
          <label>例句（英文）</label>
          <input type="text" id="input-sent1-en"
            placeholder="Traveling is a great opportunity to broaden your horizon.">
        </div>
        <div class="form-group">
          <label>例句（中文）</label>
          <input type="text" id="input-sent1-cn" placeholder="旅行是擴展視野的絕佳機會。">
        </div>
      </div>

      <div class="modal-actions">
        <button class="tool-btn" onclick="closeAddModal()">取消</button>
        <button class="tool-btn primary" onclick="saveNewWord()">💾 儲存卡片</button>
      </div>
    </div>
  </div>

  <!-- AI 生成 Modal -->
  <div class="modal-overlay" id="ai-modal">
    <div class="modal">
      <h2>✨ AI 生成單字卡</h2>
      <p style="color: #6B7280; font-size: 0.9rem; margin-top: 0;">
        輸入英文單字，AI 將自動生成完整的學習卡片（包含詞性、音標、解釋、搭配詞和例句）
      </p>
      <div class="form-group">
        <label>英文單字</label>
        <input type="text" id="ai-word-input" placeholder="例如：opportunity, serendipity">
      </div>
      <div id="ai-loading" style="display: none; text-align: center; padding: 20px;">
        <div class="spinner"></div>
        <p style="color: #6B7280; margin-top: 10px;">AI 正在生成中，請稍候...</p>
      </div>
      <div class="modal-actions">
        <button class="tool-btn" onclick="closeAIModal()">取消</button>
        <button class="tool-btn primary" id="ai-generate-btn" onclick="generateWithAI()">
          🤖 AI 生成
        </button>
      </div>
    </div>
  </div>

  <!-- 管理單字庫 Modal -->
  <div class="modal-overlay" id="manage-modal">
    <div class="modal modal-large">
      <h2>📚 管理單字庫</h2>
      <p style="color: #6B7280; font-size: 0.9rem; margin-top: 0;">
        共 <strong id="total-words">0</strong> 個單字
      </p>
      <div class="word-list" id="word-list">
        <!-- 單字列表將由 JavaScript 動態生成 -->
      </div>
      <div class="modal-actions">
        <button class="tool-btn" onclick="closeManageModal()">關閉</button>
      </div>
    </div>
  </div>

  <!-- 匯入 Modal -->
  <div class="modal-overlay" id="import-modal">
    <div class="modal">
      <h2>📥 匯入 JSON 備份</h2>
      <textarea id="json-input" rows="8" placeholder="貼上之前備份的 JSON 陣列（[ { word: ... }, ... ]）"></textarea>
      <div class="modal-actions">
        <button class="tool-btn" onclick="closeImportModal()">取消</button>
        <button class="tool-btn success" onclick="processImport()">確定匯入</button>
      </div>
    </div>
  </div>

  <!-- 測驗設定 Modal -->
  <div class="modal-overlay" id="quiz-setup-modal">
    <div class="modal">
      <h2>📝 測驗設定</h2>

      <div class="form-group">
        <label>題目數量</label>
        <select id="quiz-count">
          <option value="10">10 題</option>
          <option value="20" selected>20 題</option>
          <option value="50">50 題</option>
          <option value="all">全部單字</option>
        </select>
      </div>

      <div class="form-group">
        <label>選題方式</label>
        <select id="quiz-mode">
          <option value="random">隨機抽選</option>
          <option value="select">手動選取</option>
        </select>
      </div>

      <div id="word-selection" style="display: none;">
        <label>選擇要測驗的單字（點擊選取/取消）</label>
        <div class="word-selection-list" id="word-selection-list"></div>
      </div>

      <div class="modal-actions">
        <button class="tool-btn" onclick="closeQuizSetup()">取消</button>
        <button class="tool-btn success" onclick="startQuiz()">開始測驗</button>
      </div>
    </div>
  </div>

  <!-- 測驗進行中 Modal -->
  <div class="modal-overlay" id="quiz-modal">
    <div class="modal modal-large">
      <button class="modal-close-btn" onclick="closeQuizWithConfirm()" title="關閉測驗">✕</button>
      <div class="quiz-header">
        <h2>📝 單字測驗</h2>
        <div class="quiz-progress">
          <span id="quiz-current">1</span> / <span id="quiz-total">20</span>
        </div>
      </div>

      <div class="quiz-progress-bar">
        <div class="quiz-progress-fill" id="quiz-progress-fill"></div>
      </div>

      <div class="quiz-question">
        <div class="quiz-chinese" id="quiz-chinese">中文</div>
        <div class="quiz-pos" id="quiz-pos">n.</div>
      </div>

      <div class="quiz-input-group">
        <label>請輸入英文單字（不分大小寫）</label>
        <input type="text" id="quiz-answer" placeholder="輸入英文單字..." autocomplete="off"
          onkeypress="if(event.key==='Enter') submitAnswer()">
      </div>

      <div class="quiz-actions">
        <button class="tool-btn" onclick="skipQuestion()">跳過</button>
        <button class="tool-btn primary" onclick="submitAnswer()">提交答案</button>
        <button class="tool-btn warning" onclick="finishQuizEarly()">結束測驗</button>
      </div>

      <div class="quiz-feedback" id="quiz-feedback"></div>
    </div>
  </div>

  <!-- 測驗結果 Modal -->
  <div class="modal-overlay" id="quiz-result-modal">
    <div class="modal modal-large">
      <h2>🎉 測驗完成！</h2>

      <div class="result-score">
        <div class="score-circle">
          <div class="score-number" id="score-number">0</div>
          <div class="score-label">分</div>
        </div>
        <div class="score-stats">
          <div class="stat-item">
            <span class="stat-value correct" id="correct-count">0</span>
            <span class="stat-label">答對</span>
          </div>
          <div class="stat-item">
            <span class="stat-value wrong" id="wrong-count">0</span>
            <span class="stat-label">答錯</span>
          </div>
          <div class="stat-item">
            <span class="stat-value skip" id="skip-count">0</span>
            <span class="stat-label">跳過</span>
          </div>
        </div>
      </div>

      <div class="result-details">
        <h3>詳細結果</h3>
        <div id="result-list"></div>
      </div>

      <div class="modal-actions">
        <button class="tool-btn" onclick="closeQuizResult()">關閉</button>
        <button class="tool-btn success" onclick="retryQuiz()">再測一次</button>
      </div>
    </div>
  </div>

  <!-- 兩層選單畫面 -->
  <div id="level-select-screen" class="screen hidden">
    <button class="back-btn" onclick="showScreen('home-screen')">← 返回</button>
    <h2 class="screen-title" id="level-select-title">請選擇學制</h2>
    <button class="back-btn secondary hidden" id="tier-back-btn" onclick="backToTier1()">← 返回上一層</button>

    <!-- 第一層：學制選擇 -->
    <div id="tier1-selection" class="level-grid">
      <button class="level-btn" data-tier1="JH">
        <span class="level-title">國中 2000</span>
        <span class="level-desc" id="jh-count">載入中...</span>
      </button>
      <button class="level-btn" data-tier1="SH">
        <span class="level-title">高中 6000</span>
        <span class="level-desc" id="sh-count">載入中...</span>
      </button>
      <button class="level-btn" data-tier1="ADV">
        <span class="level-title">進階 7000</span>
        <span class="level-desc" id="adv-count">載入中...</span>
      </button>
    </div>

    <!-- 第二層：國中年級選擇 -->
    <div id="tier2-jh" class="level-grid hidden">
      <button class="level-btn" data-level="J1">
        <span class="level-title">國一</span>
        <span class="level-desc" id="j1-count">載入中...</span>
      </button>
      <button class="level-btn" data-level="J2">
        <span class="level-title">國二</span>
        <span class="level-desc" id="j2-count">載入中...</span>
      </button>
      <button class="level-btn" data-level="J3">
        <span class="level-title">國三</span>
        <span class="level-desc" id="j3-count">載入中...</span>
      </button>
      <button class="level-btn" data-level="JH_ALL">
        <span class="level-title">全部國中</span>
        <span class="level-desc">J1+J2+J3</span>
      </button>
    </div>

    <!-- 第二層：高中年級選擇 -->
    <div id="tier2-sh" class="level-grid hidden">
      <button class="level-btn" data-level="H1">
        <span class="level-title">高一</span>
        <span class="level-desc" id="h1-count">載入中...</span>
      </button>
      <button class="level-btn" data-level="H2">
        <span class="level-title">高二</span>
        <span class="level-desc" id="h2-count">載入中...</span>
      </button>
      <button class="level-btn" data-level="H3">
        <span class="level-title">高三</span>
        <span class="level-desc" id="h3-count">載入中...</span>
      </button>
      <button class="level-btn" data-level="SH_ALL">
        <span class="level-title">全部高中</span>
        <span class="level-desc">H1+H2+H3</span>
      </button>
    </div>
  </div>

  <!-- 發音測驗畫面 -->
  <div id="quiz-screen" class="screen hidden">
    <button class="back-btn" onclick="showScreen('home-screen')">← 返回</button>
    <h2 class="screen-title">發音測驗</h2>

    <div class="quiz-container">
      <div class="quiz-card">
        <button id="quiz-play-btn" class="big-play-btn" onclick="playQuizAudio()">🔊</button>
        <p class="hint-text">點擊按鈕聽發音</p>

        <div class="quiz-input-group">
          <input type="text" id="quiz-input" placeholder="輸入聽到的單字..." autocomplete="off">
          <button id="quiz-submit-btn" class="action-btn" onclick="submitQuizAnswer()">送出</button>
        </div>

        <div id="quiz-result" class="quiz-result hidden">
          <h3 id="quiz-result-status"></h3>
          <p>正確答案：<span id="quiz-correct-answer"></span></p>
        </div>

        <button id="quiz-next-btn" class="next-btn" onclick="nextQuizQuestion()" disabled>⟳ 下一題</button>
      </div>

      <div class="quiz-progress">
        <span id="quiz-current">1</span> / <span id="quiz-total">20</span>
      </div>
    </div>
  </div>

  <!-- 高中進階訓練畫面 -->
  <div id="advanced-screen" class="screen hidden">
    <button class="back-btn" onclick="showScreen('home-screen')">← 返回</button>
    <h2 class="screen-title">高中進階訓練</h2>

    <!-- Tab 導航 -->
    <div class="tab-nav">
      <button class="tab-btn active" onclick="switchTab('grimm')">格林法則</button>
      <button class="tab-btn" onclick="switchTab('verb3')">動詞三態</button>
    </div>

    <!-- Tab 內容 -->
    <div class="tab-content">
      <!-- 格林法則 -->
      <div id="tab-grimm" class="tab-pane active">
        <h3>格林法則（Grimm's Law）</h3>
        <p class="tab-desc">語音演變規律，幫助理解單字之間的關係</p>
        <div class="grimm-content">
          <p>格林法則是描述印歐語系中輔音演變的規律。以下是一些常見的對應關係：</p>
          <ul>
            <li><strong>p → f</strong>: pater (拉丁文) → father (英文)</li>
            <li><strong>t → th</strong>: tres (拉丁文) → three (英文)</li>
            <li><strong>k → h</strong>: centum (拉丁文) → hundred (英文)</li>
          </ul>
          <p class="note">更多內容將陸續新增...</p>
        </div>
      </div>

      <!-- 動詞三態 -->
      <div id="tab-verb3" class="tab-pane hidden">
        <h3>動詞三態練習</h3>

        <!-- 國中/高中選擇 -->
        <div class="verb-level-select">
          <button class="verb-level-btn active" onclick="selectVerbLevel('JH')">國中動詞三態</button>
          <button class="verb-level-btn" onclick="selectVerbLevel('SH')">高中動詞三態</button>
        </div>

        <!-- 動詞三態測驗區 -->
        <div id="verb3-quiz-container" class="verb3-container">
          <div class="verb3-question">
            <p>原形：<span id="verb3-base" class="verb-form">載入中...</span></p>
            <p class="verb-translation" id="verb3-translation"></p>
          </div>
          <div class="verb3-inputs">
            <div class="input-group">
              <label>過去式 (Past):</label>
              <input type="text" id="verb3-past-input" autocomplete="off">
            </div>
            <div class="input-group">
              <label>過去分詞 (P.P.):</label>
              <input type="text" id="verb3-pp-input" autocomplete="off">
            </div>
          </div>
          <button id="verb3-submit" class="action-btn" onclick="submitVerb3Answer()">送出</button>
          <div id="verb3-result" class="verb3-result hidden"></div>
          <button id="verb3-next" class="next-btn" onclick="nextVerb3Question()" disabled>⟳ 下一題</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 自訂義訓練畫面 -->
  <div id="custom-training-screen" class="screen hidden">
    <button class="back-btn" onclick="showScreen('home-screen')">← 返回</button>
    <h2 class="screen-title">自訂義訓練</h2>

    <div class="custom-training-container">
      <h3>貼上想練習的單字</h3>
      <p class="hint-text">一次最多約 100 個單字（換行、逗號或空白分隔皆可）</p>

      <textarea id="custom-words-input" rows="8" placeholder="例如：
go, come, book
cat happy
ability"></textarea>

      <button class="action-btn" onclick="searchCustomWords()">查詢單字</button>

      <div id="custom-results" class="custom-results hidden">
        <h4>查詢結果</h4>
        <p>找到 <span id="custom-valid-count">0</span> 個有效單字</p>
        <p class="invalid-words">找不到的單字：<span id="custom-invalid-list"></span></p>

        <div class="custom-actions">
          <button class="action-btn" onclick="startCustomPractice()">📖 用這一批開始單字練習</button>
          <button class="action-btn" onclick="startCustomQuiz()">🎧 用這一批開始發音測驗</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 新增單字畫面 -->
  <div id="add-screen" class="screen hidden">
    <button class="back-btn" onclick="showScreen('home-screen')">← 返回</button>
    <h2 class="screen-title">新增單字</h2>

    <div class="add-container">
      <div class="form-group">
        <label>英文單字</label>
        <input type="text" id="add-english" placeholder="例如：serendipity">
      </div>
      <div class="form-group">
        <label>詞性</label>
        <input type="text" id="add-pos" placeholder="例如：n.">
      </div>
      <div class="form-group">
        <label>中文翻譯</label>
        <input type="text" id="add-translation" placeholder="例如：意外的驚喜">
      </div>
      <div class="form-group">
        <label>等級</label>
        <select id="add-level">
          <option value="J1">國一 (J1)</option>
          <option value="J2">國二 (J2)</option>
          <option value="J3">國三 (J3)</option>
          <option value="H1">高一 (H1)</option>
          <option value="H2">高二 (H2)</option>
          <option value="H3">高三 (H3)</option>
          <option value="ADV">進階 (ADV)</option>
        </select>
      </div>
      <div class="form-group">
        <label>例句（英文）</label>
        <input type="text" id="add-example-en" placeholder="例如：Finding this book was pure serendipity.">
      </div>
      <div class="form-group">
        <label>例句（中文）</label>
        <input type="text" id="add-example-zh" placeholder="例如：找到這本書純屬意外的驚喜。">
      </div>

      <button class="action-btn" onclick="saveNewWord()">💾 儲存單字</button>
      <div id="add-message" class="message-box hidden"></div>
    </div>
  </div>

  <!-- 刪除單字畫面 -->
  <div id="delete-screen" class="screen hidden">
    <button class="back-btn" onclick="showScreen('home-screen')">← 返回</button>
    <h2 class="screen-title">刪除單字</h2>

    <div class="delete-container">
      <div class="search-box">
        <input type="text" id="delete-search" placeholder="搜尋單字..." oninput="filterDeleteList()">
      </div>
      <ul id="delete-list" class="word-list">
        <!-- 動態生成的單字列表 -->
      </ul>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast">訊息提示</div>

  <!-- 資料模組 -->
  <script src="data/wordsData.js"></script>
  <script src="data/verb3Data.js"></script>

  <!-- 核心模組 -->
  <script src="core/config.js"></script>
  <script src="core/state.js"></script>

  <!-- 服務層 -->
  <script src="services/storage.js"></script>
  <script src="services/audio.js"></script>
  <script src="services/wordService.js"></script>

  <!-- UI 層 -->
  <script src="ui/dom.js"></script>
  <script src="ui/screens.js"></script>
  <script src="ui/events.js"></script>

  <!-- 主程式入口 -->
  <script src="main.js"></script>

</body>

</html>